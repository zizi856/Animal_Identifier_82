import tkinter as tk
from tkinter import filedialog
from tensorflow.keras.preprocessing import image
from tensorflow.keras.models import load_model
import numpy as np
from PIL import ImageTk, Image
import pickle

# بارگذاری مدل
model = load_model('animal_model.keras')

# بارگذاری دیکشنری کلاس‌ها
with open('class_names.pkl', 'rb') as f:
    class_names = pickle.load(f)

# نگاشت نام کلاس‌ها از ایتالیایی به انگلیسی
label_mapping = {
    'cavallo': 'horse',
    'dog': 'dog',
    'elefante': 'elephant',
    'farfalla': 'butterfly',
    'gallina': 'chicken',
    'gatto': 'cat',
    'mucca': 'cow',
    'pecora': 'sheep',
    'ragno': 'spider',
    'scoiattolo': 'squirrel'
}

# توضیحات فارسی برای حیوانات
animal_info = {
    'cat': 'گربه‌ها حیواناتی خانگی، بازیگوش و دوست‌داشتنی هستند. آن‌ها معمولاً رفتار مستقلی دارند، اما می‌توانند رابطه‌ای صمیمی با انسان‌ها برقرار کنند. گربه‌ها از حواس بسیار قوی مانند بینایی در شب و شنوایی فوق‌العاده برخوردارند. آن‌ها اغلب برای شکار حیوانات کوچک مثل موش استفاده می‌شوند و به تمیزی خود بسیار اهمیت می‌دهند.',
    'dog': 'سگ‌ها از وفادارترین و اجتماعی‌ترین حیوانات خانگی هستند. آن‌ها توانایی بالایی در یادگیری دارند و برای نگهبانی، راهنمایی نابینایان، جست‌وجو و نجات و حتی درمان روحی به کار گرفته می‌شوند. سگ‌ها معمولاً نسبت به صاحب خود بسیار وفادار هستند و برای ارتباط با انسان‌ها از صداها و حرکات بدن استفاده می‌کنند.',
    'elephant': 'فیل‌ها بزرگ‌ترین حیوانات خشکی‌زی هستند. آن‌ها حافظه‌ای بسیار قوی دارند و می‌توانند احساساتی مانند غم، شادی و همدردی را نشان دهند. فیل‌ها به صورت گروهی زندگی می‌کنند و ارتباطات اجتماعی پیچیده‌ای دارند. آن‌ها از خرطوم خود برای خوردن، آشامیدن، نفس کشیدن و لمس کردن استفاده می‌کنند.',
    'horse': 'اسب‌ها حیواناتی نجیب، سریع و هوشمند هستند که هزاران سال است در خدمت انسان‌ها قرار دارند. آن‌ها در حمل‌ونقل، کشاورزی، ورزش و حتی درمان استفاده می‌شوند. اسب‌ها به خوبی با انسان ارتباط برقرار می‌کنند و می‌توانند حرکات آموزشی پیچیده‌ای را یاد بگیرند.',
    'lion': 'شیر یکی از شکارچیان برتر طبیعت و نماد قدرت و شجاعت است. شیرها به‌طور گروهی به نام "گله" زندگی می‌کنند که معمولاً شامل یک یا چند نر و چند ماده است. نرها با یال‌های پرپشت خود شناخته می‌شوند. شیرها اغلب در شب شکار می‌کنند و صدای غرّش آن‌ها می‌تواند تا چند کیلومتر شنیده شود.',
    'cow': 'گاوها از مهم‌ترین حیوانات اهلی هستند که به دلیل شیر، گوشت و پوستشان پرورش داده می‌شوند. آن‌ها حیواناتی آرام، اجتماعی و نشخوارکننده هستند. گاوها حافظه قوی دارند و می‌توانند چهره‌ها و مکان‌ها را به‌خاطر بسپارند. رفتار گروهی و احساسات اجتماعی در میان آن‌ها بسیار قابل توجه است.',
    'chicken': 'مرغ‌ها پرندگانی خانگی هستند که برای تخم‌مرغ و گوشتشان پرورش داده می‌شوند. آن‌ها توانایی یادگیری از تجربه و تشخیص چهره انسان‌ها را دارند. مرغ‌ها دارای ساختار اجتماعی مشخصی هستند و حتی برای ارتباط با جوجه‌های خود صداهای خاصی تولید می‌کنند.',
    'butterfly': 'پروانه‌ها حشراتی زیبا و رنگارنگ هستند که نماد دگرگونی و تولد دوباره‌اند. آن‌ها از تخم، لارو، شفیره و نهایتاً پروانه بالغ تشکیل می‌شوند. پروانه‌ها با تغذیه از شهد گل‌ها در گرده‌افشانی گل‌ها نقش مهمی دارند. بال‌های آن‌ها دارای طرح‌ها و رنگ‌های خیره‌کننده‌ای هستند که گاهی نقش دفاعی دارند.',
    'sheep': 'گوسفندها حیواناتی اهلی هستند که بیشتر برای پشم، گوشت و شیر پرورش می‌یابند. آن‌ها معمولاً به صورت گله‌ای زندگی می‌کنند و رفتار بسیار آرامی دارند. گوسفندها حافظه تصویری خوبی دارند و می‌توانند چهره انسان و گوسفندان دیگر را تشخیص دهند. همچنین، برای کنترل استرس به بودن در کنار سایر گوسفندان نیاز دارند.',
    'spider': 'عنکبوت‌ها شکارچیانی ماهر هستند که در بسیاری از زیست‌بوم‌ها زندگی می‌کنند. آن‌ها با استفاده از تارهای خود طعمه‌ها را به دام می‌اندازند. برخی گونه‌های عنکبوت سمی‌اند، اما بیشتر آن‌ها برای انسان بی‌خطرند. تار عنکبوت یکی از قوی‌ترین مواد طبیعی در مقایسه با وزن خود است.',
    'squirrel': 'سنجاب‌ها جونده‌هایی با دم پرپشت و چشمان درشت‌اند که بیشتر در جنگل‌ها و پارک‌ها دیده می‌شوند. آن‌ها بسیار چابک و سریع هستند و بیشتر وقت خود را صرف جمع‌آوری و ذخیره غذا، به‌ویژه دانه‌ها و آجیل‌ها می‌کنند. سنجاب‌ها توانایی بالایی در پریدن و بالا رفتن از درخت دارند.'
}
def predict_image(img_path):
    img = image.load_img(img_path, target_size=(128, 128))
    img_array = image.img_to_array(img)
    img_array = np.expand_dims(img_array, axis=0) / 255.0
    prediction = model.predict(img_array)
    predicted_index = np.argmax(prediction)
    predicted_class = list(class_names.keys())[list(class_names.values()).index(predicted_index)]
    english_name = label_mapping.get(predicted_class, predicted_class)
    return english_name

def select_image():
    file_path = filedialog.askopenfilename()
    if not file_path:
        return

    animal = predict_image(file_path)
    info = animal_info.get(animal, 'توضیحی برای این حیوان موجود نیست.')

    # نمایش تصویر
    img = Image.open(file_path)
    img = img.resize((200, 200))
    img_tk = ImageTk.PhotoImage(img)
    image_label.configure(image=img_tk)
    image_label.image = img_tk

    # نمایش نتیجه
    result_label.config(text=f"{animal} :حیوان شناسایی شده")
    info_label.config(text=info)

# رابط گرافیکی
root = tk.Tk()
root.title("تشخیص حیوان از روی عکس")
root.geometry("500x550")

image_label = tk.Label(root)
image_label.pack(pady=10)

btn = tk.Button(root, text="انتخاب تصویر", command=select_image)
btn.pack(pady=10)

result_label = tk.Label(root, text="", font=("Arial", 14))
result_label.pack(pady=10)

info_label = tk.Label(root, text="", wraplength=450, justify="center", font=("Arial", 12))
info_label.pack(pady=10)

root.mainloop()